{% extends "base.html" %}

{% block meta_title %}Mile transactions{% endblock %}

{% macro page_before(txs) %}
    {% if txs and pagination_has_prev %}
        <a class="btn btn-dark btn-sm" href="/transactions?before={{ (txs|first).block_id }}_{{ (txs|first).num_in_block }}">
            ü°ê
        </a>
    {% endif %}
{% endmacro %}
{% macro page_after(txs) %}
    {% if txs %}
        <a class="btn btn-dark btn-sm" href="/transactions?after={{ (txs|last).block_id }}_{{ (txs|last).num_in_block }}">
            ü°í
        </a>
    {% endif %}
{% endmacro %}
{% macro tx_value(tx) %}
    {{ ('{:,}'.format(tx.mile) if tx.mile else ('{:,}'.format(tx.xdr) if tx.xdr else '')).replace(',', '&nbsp;').rstrip('0').rstrip('.') }}
{% endmacro %}

{% macro txs_table(transactions) %}
    <table class="table table-striped table-hover table-sm table-responsive-md">
        <thead class="thead-dark">
        <tr>
            <th scope="col">tx hash</th>
            <th scope="col">block</th>
            <th scope="col">date</th>
            <th scope="col">type</th>
            <th scope="col">from</th>
            <th scope="col">to</th>
            <th scope="col">amount</th>
            <th scope="col">description</th>
        </tr>
        </thead>
        <tbody>
        {% for tx in transactions %}
        <tr>
            <td><a href="/transactions/{{ tx.digest }}" title="{{ tx.digest }}">{{ tx.digest|truncate(10) }}</a></td>
            <td><a href="/blocks/{{ tx.block_id }}">{{ tx.block_id }}</a></td>
            <td>{{ tx.timestamp.strftime('%H:%M:%S %d.%m.%Y') }}</td>
            <td>{{ tx.human_type() }}</td>
            <td>
                {% if tx.wallet_from %}
                    <a href="/wallets/{{ tx.wallet_from }}">{{ tx.wallet_from|truncate(15) }}</a>
                {% else %}
                    &nbsp;
                {% endif %}
            </td>
            <td>
                {% if tx.wallet_to %}
                    <a href="/wallets/{{ tx.wallet_to }}">{{ tx.wallet_to|truncate(15) }}</a>
                {% else %}
                    &nbsp;
                {% endif %}
            </td>
            <td>{{ tx_value(tx) }}</td>
            <td><div title="tx.description">{{ tx.description|truncate(75) }}</div></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
{% endmacro %}

{% block content %}

    <div class="row" style="margin-bottom: 10px">
        <div class="col-md-1">
            {{ page_before(transactions) }}
        </div>
        <div class="col-md-1 offset-md-10 text-right font-weight-bold">
            {{ page_after(transactions) }}
        </div>
    </div>

    {{ txs_table(transactions) }}

    <div class="row" style="margin-top: 10px">
        <div class="col-md-1">
            {{ page_before(transactions) }}
        </div>
        <div class="col-md-1 offset-md-10 text-right font-weight-bold">
            {{ page_after(transactions) }}
        </div>
    </div>

{% endblock %}